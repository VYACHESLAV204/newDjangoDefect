{% extends "base.html" %}
{% load humanize %}
{% load display_tags %}
{% load static %}
{% block add_styles %}
    {{ block.super }}
{% endblock %}
{% block content %}
    {{ block.super }}
    <div style="border-radius:20px !important" class="panel panel-default">
        <div class="panel-heading tight">
            <div class="clearfix align-100">
              <h3 style="justify-content:space-between;" class="has-filters">
                    Обзор метрик
                <div class="dropdown pull-right ">
                    <button id="show-filters" data-toggle="collapse" data-target="#the-filters" class="btn btn-primary toggle-filters"> <i class="fa-solid fa-filter"></i> <i class="caret"></i> </button>
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenu1"
                            data-toggle="dropdown" label="view_selector" aria-label="view_selector" aria-expanded="true">
                        <span class="fa-solid fa-bars"></span>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1">
                        <li role="presentation">
                            <a href="{% url 'view_product_metrics' prod.id %}?type=Finding">
                                <i class="fa-solid fa-file-lines"></i> Измерить Находки
                            </a>
                        </li>
                        <li role="presentation">
                            <a href="{% url 'view_product_metrics' prod.id %}?type=Endpoint">
                                <i class="fa-solid fa-file-lines"></i> Измерить Затронутые Конечные Точки
                            </a>
                        </li>
                    </ul>
                </div>
              </h3>



            </div>
        </div>
        <div id="the-filters" class="is-filters panel-body collapse">
            {% include "dojo/filter_snippet.html" with form=form clear_link=reset_link %}
        </div>
        <div class="panel-body product-graphs-overview">
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row"><div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-crosshairs fa-2x"></i>

                                <div class="pull-right inline-block metrics-header">
                                    <span class=" fa-2x">{{ verified_objs|length }}</span>
                                    <span><a
                                            href="{% url 'product_verified_findings' prod.id %}?test__engagement__product={{ prod.id }}"
                                            title="Findings that are open/active and verified">Проверенный
                                            {{ view }}{{ verified_objs|length|pluralize }}</a> 
                                        </span>
                                </div>
                            </div>
                            <i
                                                    class="fa-solid fa-circle-right"></i>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="verified_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Since {{ start_date }}."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Проверено с тех пор, как {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row"><div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-bug fa-2x"></i>

                                <div class="pull-right inline-block metrics-header">
                                    <span class=" fa-2x">{{ open_objs|length }}</span>
                                    <span><a href="{% url 'product_open_findings' prod.id %}?test__engagement__product={{ prod.id }}"
                                        title="Findings that are open/active, but not (yet) verified">Открыть
                                        {{ view }}{{ open_objs|length|pluralize }} </a>
                                    </span>
                                </div>
                            </div><i
                            class="fa-solid fa-circle-right"></i></div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="open_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Opened since {{ start_date }}"
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Открыт с тех пор, как {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row"><div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                               
                                <i class="fa-solid fa-check fa-2x"></i>

                                <div class="pull-right text-right">
                                    <span class="fa-2x">{{ accepted_objs|length }}</span>
                                </div>
                                    <span><a
                                            href="{% url 'accepted_findings' %}?test__engagement__product={{ prod.id }}"
                                            title="Findings that have been accepted in a risk acceptance.">Принятый риск
                                    {{ view }}s </a>
                                </span>
                                
                                
                            </div>
                            <i class="fa-solid fa-circle-right"></i>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="accepted_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Accepted since {{ start_date }}"
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Риск, принятый с тех пор, как {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row">
                            <div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-fire-extinguisher fa-2x"></i>

                                <div class="pull-right metrics-header">
                                    <span class="fa-2x">{{ closed_objs|length }}</span>
                                    <span><a href="{% url 'closed_findings' %}?test__engagement__product={{ prod.id }}"
                                             title="Findings that are closed and mitigated.">Закрытый
                                        {{ view }}{{ closed_objs|length|pluralize }} </a>
                                    </span>
                                </div>
                            </div><i
                            class="fa-solid fa-circle-right"></i></div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="closed_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Closed since {{ start_date }}"
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Закрыт с тех пор, как {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row">
                            <div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-fire-extinguisher fa-2x"></i>

                                <div class="pull-right metrics-header">
                                    <span class="fa-2x">{{ false_positive_objs|length }}</span>
                                    <span><a href="{% url 'product_false_positive_findings' prod.id %}?test__engagement__product={{ prod.id }}"
                                             title="Findings that are marked as false postive.">Ложноположительный
                                        {{ view }}{{ false_positive_objs|length|pluralize }} </a>
                                    </span>
                                </div>
                            </div>
                            <i
                            class="fa-solid fa-circle-right"></i>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="false_positive_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Flagged since {{ start_date }}"
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Отмечен с тех пор, как {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row">
                            <div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-fire-extinguisher fa-2x"></i>

                                <div class="pull-right inline-block metrics-header">
                                    <span class=" fa-2x">{{ out_of_scope_objs|length }}</span>
                                    <span><a
                                            href="{% url 'product_out_of_scope_findings' prod.id %}?test__engagement__product={{ prod.id }}"
                                            title="Findings that are marked as out of scope.">Вне сферы охвата
                                        {{ view }}{{ out_of_scope_objs|length|pluralize }} </a>
                                    </span>
                                </div>
                            </div>
                            <i
                            class="fa-solid fa-circle-right"></i>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="out_of_scope_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Since {{ start_date }}."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>С {{ start_date|date:"D., M. d, Y" }}.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row">
                            <div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-bullseye fa-2x"></i>

                                <div class="pull-right metrics-header">
                                    <span class="fa-2x">{{ all_objs|length }}</span>
                                    <span><a href="{% url 'product_all_findings' prod.id %}?test__engagement__product={{ prod.id }}"
                                            title="All findings.">Весь
                                        {{ view }}{{ all_objs|length|pluralize }}</a>
                                    </span>
                                </div>
                            </div>
                            <i
                            class="fa-solid fa-circle-right"></i>
                        </div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="all_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Since {{ start_date }}"
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>С {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading min-height bgc-metrics-cards">
                        <div class="row">
                            <div class="metric-header-icon">
                            <div class="col-xs-12 metrics-header">
                                <i class="fa-solid fa-bug fa-2x"></i>

                                <div class="pull-right inline-block metrics-header">
                                    <span class=" fa-2x">{{ inactive_objs|length }}</span>
                                    <span><a href="{% url 'product_inactive_findings' prod.id %}?test__engagement__product={{ prod.id }}"
                                             title="Findings that are not active but not mitigated for some reason">Неактивный
                                        {{ view }}{{ inactive_objs|length|pluralize }} </a>
                                    </span>
                                </div>
                            </div>
                            <i
                            class="fa-solid fa-circle-right"></i>
                        
                        </div>
                        </div>
                    </div>
                    <div class="panel-body metrics-bgc">
                        <div id="inactive_objs" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics">
                        <i title="Ingested since {{ start_date }}"
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Проглоченный с тех пор, как {{ start_date|date:"D., M. d, Y" }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="border-radius:20px !important;" class="panel panel-default">
        <div class="panel-heading tight">
            <div class="clearfix">
                <h3 class="pull-left">
                    Подробные показатели
                </h3>

                <div class="dropdown pull-right">
                    <div class="btn-group">
                      <!--
                        <button class="btn btn-primary clickable panel-collapsed">
                            <span><i class="fa-solid fa-chart-column"></i></span>
                        </button>
                      -->
                    </div>
                </div>
            </div>
        </div>
        <div style="border-radius:20px !important;background-color:#fff;" class="panel-body product-graphs">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Открыт изо дня в день в зависимости от степени тяжести
                        <i title="Days are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body text-center">
                        <div id="id_open_findings_burndown_loader" class="graph-loader">
                            <p><i class="fas fa-spinner fa-spin fa-2x"></i></p>
                            <p>Загрузка поисковых показателей выгорания...</p>
                        </div>
                        <div id="open_findings_burndown" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i class="text-info fa-solid fa-circle-info"></i>
                        <small>Дни отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Открытые, закрытые и принимаемые на себя риски из недели в неделю
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div id="open_close_weekly" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Недели отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        От недели к неделе в разбивке по степени тяжести
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div id="severity_weekly" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Недели отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Критическая неделя за неделей
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div id="severity_critical" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Недели отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Высокий уровень от недели к неделе
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div id="severity_high" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Недели отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        В среднем от недели к неделе
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div id="severity_medium" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Недели отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Определение возраста
                    </div>
                    <div class="panel-body">
                        <div id="finding_age" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Определение возраста {{ open_objs|length|apnumber }} открыть
                            обнаружение{{ open_objs|length|pluralize }}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-7">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Еженедельная информация о результатах исследования
                            <i title="Weeks are only displayed if findings are available."
                            class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div class="graph" id="punchcard"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Недели отображаются только в том случае, если результаты доступны.</small>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Результаты в разбивке по типу теста
                        <i title="Test Types shown only if available."
                           class="text-info fa-solid fa-circle-info orange-icon"></i>
                    </div>
                    <div class="panel-body">
                        <div class="graph" id="test_type"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i title="Weeks are only displayed if findings are available."
                           class="text-info fa-solid fa-circle-info"></i>
                        <small>Типы тестов отображаются только в том случае, если они доступны.</small>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Открытые уязвимости CWE
                    </div>
                    <div class="panel-body">
                        <div id="open_vulnerabilities" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i class="text-info fa-solid fa-circle-info"></i>
                        <small>Показ {{ open_vulnerabilities|length|apnumber }}
                            уязвимость{{ open_vulnerabilities|length|pluralize:"y,ies"}} из открытых данных</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading panel-header-metrics bgc-metrics-cards">
                        Общее количество уязвимостей CWE
                    </div>
                    <div class="panel-body">
                        <div id="all_vulnerabilities" class="graph"></div>
                    </div>
                    <div class="panel-footer panel-footer-metrics-other-height">
                        <i class="text-info fa-solid fa-circle-info"></i>
                        <small>Показ {{ all_vulnerabilities|length|apnumber }}
                            уязвимость{{ all_vulnerabilities|length|pluralize:"y,ies"}} из открытых данных</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block postscript %}
    {{ block.super }}
    <script type="text/javascript" src="{% static "jquery-highlight/jquery.highlight.js" %}"></script>
    <!-- Flot Charts JavaScript -->
    <script src="{% static "flot/excanvas.min.js" %}"></script>
    <script src="{% static "flot/jquery.flot.js" %}"></script>
    <script src="{% static "flot/jquery.flot.pie.js" %}"></script>
    <script src="{% static "flot/jquery.flot.resize.js" %}"></script>
    <script src="{% static "flot/jquery.flot.categories.js" %}"></script>
    {% include "dojo/filter_js_snippet.html" %}
    {% if punchcard %}
        <script src="{% static "JUMFlot/javascripts/JUMFlot.min.js" %}"></script>
        <script src="{% static "JUMFlot/javascripts/jquery.flot.mouse.js" %}"></script>
        <script src="{% static "JUMFlot/javascripts/jquery.flot.bubbles.js" %}"></script>
    {% endif %}
    <script src="{% static "flot/jquery.flot.time.js" %}"></script>
    <script src="{% static "jquery.flot.tooltip/js/jquery.flot.tooltip.min.js" %}"></script>
    {% block metrics %}
        <script src="{% static "dojo/js/metrics.js" %}"></script>
    {% endblock metrics %}
    <script type="text/javascript">
        $(function () {
            if (document.referrer.indexOf('simple_search') > 0) {
                var terms = '';
                if ($.cookie('highlight')) {
                    terms = $.cookie('highlight').split(' ');

                    for (var i = 0; i < terms.length; i++) {
                        $('body').highlight(terms[i]);
                    }
                }

                $('input#simple_search').val(terms);
            }

            $(document).on('click', '.panel-heading button.clickable', function (e) {
                var $this = $(this);
                if (!$this.hasClass('panel-collapsed')) {
                    $this.parents('.panel').find('.panel-body').slideUp();
                    $this.addClass('panel-collapsed');
                    $this.find('i').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
                } else {
                    $this.parents('.panel').find('.panel-body').slideDown();
                    $this.removeClass('panel-collapsed');
                    $this.find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
                }
            });


            var ticks = [
                [0, "Critical"], [1, "High"], [2, "Medium"], [3, "Low"], [4, "Info"]
            ];

            $(document).ready(function() {
                fetch_burndown_metrics({{ prod.id }});
            })

            function fetch_burndown_metrics(pid) {
                $.ajax({
                    type: 'GET',
                    url: '/product/' + pid + '/async_burndown_metrics',
                    beforeSend: function() {
                        $('#open_findings_burndown').hide();
                        $('#id_open_findings_burndown_loader').show();
                    },
                    success: function(response) {
                        $('#open_findings_burndown').show();
                        $('#id_open_findings_burndown_loader').hide();
                        open_findings_burndown(
                            response.critical,
                            response.high,
                            response.medium,
                            response.low,
                            response.info,
                            response.max,
                            response.min,
                        );
                    }
                });
            }

            accepted_objs(
                [[0, {{ accepted_objs_by_severity.Critical }}]],
                [[1, {{ accepted_objs_by_severity.High }}]],
                [[2, {{ accepted_objs_by_severity.Medium }}]],
                [[3, {{ accepted_objs_by_severity.Low }}]],
                [[4, {{ accepted_objs_by_severity.Info }}]],
                ticks);

            inactive_objs(
                [[0, {{ inactive_objs_by_severity.Critical }}]],
                [[1, {{ inactive_objs_by_severity.High }}]],
                [[2, {{ inactive_objs_by_severity.Medium }}]],
                [[3, {{ inactive_objs_by_severity.Low }}]],
                [[4, {{ inactive_objs_by_severity.Info }}]],
                ticks);

            open_objs(
                [[0, {{ open_objs_by_severity.Critical }}]],
                [[1, {{ open_objs_by_severity.High }}]],
                [[2, {{ open_objs_by_severity.Medium }}]],
                [[3, {{ open_objs_by_severity.Low }}]],
                [[4, {{ open_objs_by_severity.Info }}]],
                ticks);

            false_positive_objs(
                [[0, {{ false_positive_objs_by_severity.Critical }}]],
                [[1, {{ false_positive_objs_by_severity.High }}]],
                [[2, {{ false_positive_objs_by_severity.Medium }}]],
                [[3, {{ false_positive_objs_by_severity.Low }}]],
                [[4, {{ false_positive_objs_by_severity.Info }}]],
                ticks);

            verified_objs(
                [[0, {{ verified_objs_by_severity.Critical }}]],
                [[1, {{ verified_objs_by_severity.High }}]],
                [[2, {{ verified_objs_by_severity.Medium }}]],
                [[3, {{ verified_objs_by_severity.Low }}]],
                [[4, {{ verified_objs_by_severity.Info }}]],
                ticks);

            out_of_scope_objs(
                [[0, {{ out_of_scope_objs_by_severity.Critical }}]],
                [[1, {{ out_of_scope_objs_by_severity.High }}]],
                [[2, {{ out_of_scope_objs_by_severity.Medium }}]],
                [[3, {{ out_of_scope_objs_by_severity.Low }}]],
                [[4, {{ out_of_scope_objs_by_severity.Info }}]],
                ticks);

            all_objs(
                [[0, {{ all_objs_by_severity.Critical }}]],
                [[1, {{ all_objs_by_severity.High }}]],
                [[2, {{ all_objs_by_severity.Medium }}]],
                [[3, {{ all_objs_by_severity.Low }}]],
                [[4, {{ all_objs_by_severity.Info }}]],
                ticks);

            closed_objs(
                [[0, {{ closed_objs_by_severity.Critical }}]],
                [[1, {{ closed_objs_by_severity.High }}]],
                [[2, {{ closed_objs_by_severity.Medium }}]],
                [[3, {{ closed_objs_by_severity.Low }}]],
                [[4, {{ closed_objs_by_severity.Info }}]],
                ticks);

            new_objs(
                [[0, {{ new_objs_by_severity.Critical }}]],
                [[1, {{ new_objs_by_severity.High }}]],
                [[2, {{ new_objs_by_severity.Medium }}]],
                [[3, {{ new_objs_by_severity.Low }}]],
                [[4, {{ new_objs_by_severity.Info }}]],
                ticks);

            
            var opened = [];
            var closed = [];
            var accepted = [];
            ticks = [];
            {% for week, values in open_close_weekly.items %}
                ticks.push([{{ forloop.counter0 }}, "{{ values.week|safe }}"])
                opened.push([{{ forloop.counter0 }}, {{ values.open }}])
                closed.push([{{ forloop.counter0 }}, {{ values.closed }}])
                accepted.push([{{ forloop.counter0 }}, {{ values.accepted }}])
            {% endfor %}
            open_close_weekly(opened, closed, accepted, ticks);
            
            let critical = [];
            let high = [];
            let medium = [];
            let low = [];
            let info = [];
            ticks = [];
            {% for week, values in severity_weekly.items %}
                ticks.push([{{ forloop.counter0 }}, "{{ values.week|safe }}"]);
                critical.push([{{ forloop.counter0 }}, {{ values.Critical }}]);
                high.push([{{ forloop.counter0 }}, {{ values.High }}]);
                medium.push([{{ forloop.counter0 }}, {{ values.Medium }}]);
                low.push([{{ forloop.counter0 }}, {{ values.Low }}]);
                info.push([{{ forloop.counter0 }}, {{ values.Info }}]);
            {% endfor %}
            severity_weekly(critical, high, medium, low, info, ticks);
            
            critical = [];
            high = [];
            medium = [];
            ticks = [];
            {% for week, values in critical_weekly.items %}
                ticks.push([{{ forloop.counter0 }}, "{{ values.week|safe }}"]);
                critical.push([{{ forloop.counter0 }}, {{ values.count }}]);
            {% endfor %}
            {% for week, values in high_weekly.items %}
                ticks.push([{{ forloop.counter0 }}, "{{ values.week|safe }}"]);
                high.push([{{ forloop.counter0 }}, {{ values.count }}]);
            {% endfor %}
            {% for week, values in medium_weekly.items %}
                ticks.push([{{ forloop.counter0 }}, "{{ values.week|safe }}"]);
                medium.push([{{ forloop.counter0 }}, {{ values.count }}]);
            {% endfor %}
            severity_counts_weekly(critical, high, medium, ticks);
            
            var data = []
            {% for x, y in test_data.items %}
                {% if y > 0 %}
                    data.push(['{{x}}', {{ y }}]);
                {%  endif %}
            {% endfor %}
            test_type(data);
            
            var data_2 = []
            var ticks = []

            var i = 0;
            $.each({{ open_objs_by_age }}, function (index, value) {
                if (value > 0) {
                    data_2.push([i, value]);
                    ticks.push([i, index])
                }
                i++;
            });
            finding_age(data_2, ticks);
            
            data = [];
            {% for x in open_vulnerabilities %}
                data.push(['CWE-{{x.cwe}}', {{x.count}}]);
            {% endfor %}
            draw_vulnerabilities_graph("#open_vulnerabilities", data);
            
            data = [];
            {% for x in all_vulnerabilities %}
                data.push(['CWE-{{x.cwe}}', {{x.count}}]);
            {% endfor %}
            draw_vulnerabilities_graph("#all_vulnerabilities", data);

            //$(".product-graphs").hide();
            $("#meta_accordion").accordion();
        });

        {%  if punchcard %}

            punchcard("#punchcard", {{ punchcard|safe }}, {{ ticks|safe }});

        {%  endif %}


    </script>
{% endblock %}
